# Telegram бот для отправки вакансий

## Описание

Система состоит из двух скриптов:

1. **`telegram_vacancy_bot.py`** - Полнофункциональный бот с обработкой callback
2. **`send_vacancies_to_telegram.py`** - Упрощенная версия для простой отправки

## Быстрый старт

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка бота

Следуйте инструкциям в файле `telegram_setup.md` для:
- Создания бота через @BotFather
- Получения токена
- Получения Chat ID

### 3. Установка переменных окружения

```bash
export TELEGRAM_BOT_TOKEN="ваш_токен_бота"
export TELEGRAM_CHAT_ID="ваш_chat_id"
```

### 4. Запуск

#### Вариант 1: Полнофункциональный бот (с обработкой кнопок)

```bash
python3 telegram_vacancy_bot.py
```

Затем в Telegram:
- `/start` - начало работы
- `/send` - отправить все вакансии из файла

#### Вариант 2: Простая отправка (без обработки кнопок)

```bash
# Сначала обновить список с hh.ru и Habr, затем отправить (рекомендуется — актуальные вакансии)
python3 send_vacancies_to_telegram.py --refresh

# Отправить только вакансии за последние 3 дня из уже сохранённого файла
python3 send_vacancies_to_telegram.py

# Отправить все вакансии из файла без фильтра по дате
python3 send_vacancies_to_telegram.py --all
```

Скрипт по умолчанию отправляет только вакансии за последние 3 дня, чтобы не слать устаревшие. Чтобы отправить свежие вакансии на сегодня, используйте `--refresh`.

## Как это работает

1. Скрипт загружает вакансии из `product_manager_vacancies.json`
2. Для каждой вакансии отправляется сообщение с информацией:
   - Название вакансии
   - Компания
   - Локация
   - Зарплата
   - Ссылка
3. К каждой вакансии добавляются кнопки:
   - ✅ **Да, составить** - генерирует сопроводительное письмо
   - ❌ **Нет** - просто подтверждает, что письмо не нужно

## Генерация сопроводительного письма

При нажатии "Да, составить":

1. Бот получает описание вакансии через HH API
2. Анализирует ключевые слова и требования
3. Генерирует персонализированное сопроводительное письмо
4. Отправляет письмо в чат

### Улучшение генерации писем

Для более качественной генерации можно использовать OpenAI API:

```bash
export OPENAI_API_KEY="ваш_openai_api_key"
pip install openai
```

## Постоянный запуск бота

Для того, чтобы бот работал постоянно и обрабатывал команды и кнопки, его нужно запустить в фоновом режиме.

**Подробная инструкция:** См. файл `BOT_DEPLOYMENT.md`

### Быстрый старт (screen):

```bash
# 1. Создайте сессию screen
screen -S telegram_bot

# 2. Запустите бота
cd /Users/konovalovmihail/hr_app
./start_bot.sh

# 3. Отключитесь от сессии (Ctrl+A, затем D)
# Бот продолжит работать в фоне
```

### Для macOS (launchd):

```bash
# Загрузите как системный сервис
cp com.telegram.vacancy.bot.plist ~/Library/LaunchAgents/
launchctl load ~/Library/LaunchAgents/com.telegram.vacancy.bot.plist
```

## Автоматизация

Для автоматической отправки новых вакансий можно создать cron job:

```bash
# Каждый день в 9:00 — обновить список и отправить свежие вакансии
0 9 * * * cd /path/to/hr_app && python3 send_vacancies_to_telegram.py --refresh
```

## Структура проекта

```
hr_app/
├── ios_vacancies_finder.py          # Поиск вакансий
├── telegram_vacancy_bot.py          # Полнофункциональный бот
├── send_vacancies_to_telegram.py    # Простая отправка
├── product_manager_vacancies.json   # Файл с вакансиями
├── telegram_setup.md                # Инструкция по настройке
└── requirements.txt                 # Зависимости
```

## Круглосуточная доступность (критерии приёмки 24/7)

Чтобы бот был доступен **независимо от состояния локального ПК** (выключение, сбой питания, перезагрузка) и выдерживал плавные обновления, его нужно запускать на **удалённом сервере** (VPS или PaaS), а не на своём компьютере.

**Подробный план и чек-лист:** см. [ACCEPTANCE_CRITERIA_24_7.md](ACCEPTANCE_CRITERIA_24_7.md).  
**Пошаговая инструкция по размещению на Railway:** см. [RAILWAY_DEPLOYMENT.md](RAILWAY_DEPLOYMENT.md).

## Примечания

- Бот должен быть запущен постоянно для обработки callback от кнопок
- Для работы в канале бот должен быть администратором
- Файл с вакансиями должен быть создан заранее через `ios_vacancies_finder.py`
- Callback_data ограничен 64 байтами в Telegram, поэтому используется ID вакансии вместо полного URL
